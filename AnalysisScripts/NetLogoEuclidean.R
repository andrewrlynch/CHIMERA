library("reshape2")
library("dplyr")
library("tidyr")
library("ggplot2")
library("stringr")
library("gridExtra")

#Insert datafile here:
mydata <- df
mydata$start.cin <- NULL

mydata$X.run.number. <- seq(1:length(mydata$X.run.number.))

trim.brackets <- function(x) gsub("\\[|\\]", "", x)
mydata$Chrom1.final <- trim.brackets(mydata$Chrom1.final)
mydata$Chrom2.final <- trim.brackets(mydata$Chrom2.final)
mydata$Chrom3.final <- trim.brackets(mydata$Chrom3.final)
mydata$Chrom4.final <- trim.brackets(mydata$Chrom4.final)
mydata$Chrom5.final <- trim.brackets(mydata$Chrom5.final)
mydata$Chrom6.final <- trim.brackets(mydata$Chrom6.final)
mydata$Chrom7.final <- trim.brackets(mydata$Chrom7.final)
mydata$Chrom8.final <- trim.brackets(mydata$Chrom8.final)
mydata$Chrom9.final <- trim.brackets(mydata$Chrom9.final)
mydata$Chrom10.final <- trim.brackets(mydata$Chrom10.final)
mydata$Chrom11.final <- trim.brackets(mydata$Chrom11.final)
mydata$Chrom12.final <- trim.brackets(mydata$Chrom12.final)
mydata$Chrom13.final <- trim.brackets(mydata$Chrom13.final)
mydata$Chrom14.final <- trim.brackets(mydata$Chrom14.final)
mydata$Chrom15.final <- trim.brackets(mydata$Chrom15.final)
mydata$Chrom16.final <- trim.brackets(mydata$Chrom16.final)
mydata$Chrom17.final <- trim.brackets(mydata$Chrom17.final)
mydata$Chrom18.final <- trim.brackets(mydata$Chrom18.final)
mydata$Chrom19.final <- trim.brackets(mydata$Chrom19.final)
mydata$Chrom20.final <- trim.brackets(mydata$Chrom20.final)
mydata$Chrom21.final <- trim.brackets(mydata$Chrom21.final)
mydata$Chrom22.final <- trim.brackets(mydata$Chrom22.final)
mydata$ChromX.final <- trim.brackets(mydata$ChromX.final)
#mydata$total.misseg <- trim.brackets(mydata$total.misseg)

newdf <- separate(mydata, Chrom1.final, into = c("c1.1", "c1.2", "c1.3", "c1.4", "c1.5", "c1.6", "c1.7", "c1.8", "c1.9", "c1.10", 
                                                 "c1.11", "c1.12", "c1.13", "c1.14", "c1.15", "c1.16", "c1.17", "c1.18", "c1.19", "c1.20", 
                                                 "c1.21", "c1.22", "c1.23", "c1.24", "c1.25", "c1.26", "c1.27", "c1.28", "c1.29", "c1.30", 
                                                 "c1.31", "c1.32", "c1.33", "c1.34", "c1.35", "c1.36", "c1.37", "c1.38", "c1.39", "c1.40", 
                                                 "c1.41", "c1.42", "c1.43", "c1.44", "c1.45", "c1.46", "c1.47", "c1.48", "c1.49", "c1.50", 
                                                 "c1.51", "c1.52", "c1.53", "c1.54", "c1.55", "c1.56", "c1.57", "c1.58", "c1.59", "c1.60", 
                                                 "c1.61", "c1.62", "c1.63", "c1.64", "c1.65", "c1.66", "c1.67", "c1.68", "c1.69", "c1.70", 
                                                 "c1.71", "c1.72", "c1.73", "c1.74", "c1.75", "c1.76", "c1.77", "c1.78", "c1.79", "c1.80", 
                                                 "c1.81", "c1.82", "c1.83", "c1.84", "c1.85", "c1.86", "c1.87", "c1.88", "c1.89", "c1.90", 
                                                 "c1.91", "c1.92", "c1.93", "c1.94", "c1.95", "c1.96", "c1.97", "c1.98", "c1.99", "c1.100"), 
                  extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")
newdf <- separate(newdf, Chrom2.final, into = c("c2.1", "c2.2", "c2.3", "c2.4", "c2.5", "c2.6", "c2.7", "c2.8", "c2.9", "c2.10", 
                                                "c2.11", "c2.12", "c2.13", "c2.14", "c2.15", "c2.16", "c2.17", "c2.18", "c2.19", "c2.20", 
                                                "c2.21", "c2.22", "c2.23", "c2.24", "c2.25", "c2.26", "c2.27", "c2.28", "c2.29", "c2.30", 
                                                "c2.31", "c2.32", "c2.33", "c2.34", "c2.35", "c2.36", "c2.37", "c2.38", "c2.39", "c2.40", 
                                                "c2.41", "c2.42", "c2.43", "c2.44", "c2.45", "c2.46", "c2.47", "c2.48", "c2.49", "c2.50", 
                                                "c2.51", "c2.52", "c2.53", "c2.54", "c2.55", "c2.56", "c2.57", "c2.58", "c2.59", "c2.60", 
                                                "c2.61", "c2.62", "c2.63", "c2.64", "c2.65", "c2.66", "c2.67", "c2.68", "c2.69", "c2.70", 
                                                "c2.71", "c2.72", "c2.73", "c2.74", "c2.75", "c2.76", "c2.77", "c2.78", "c2.79", "c2.80", 
                                                "c2.81", "c2.82", "c2.83", "c2.84", "c2.85", "c2.86", "c2.87", "c2.88", "c2.89", "c2.90", 
                                                "c2.91", "c2.92", "c2.93", "c2.94", "c2.95", "c2.96", "c2.97", "c2.98", "c2.99", "c2.100"), 
                  extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom3.final, into = c("c3.1", "c3.2", "c3.3", "c3.4", "c3.5", "c3.6", "c3.7", "c3.8", "c3.9", "c3.10", 
                                               "c3.11", "c3.12", "c3.13", "c3.14", "c3.15", "c3.16", "c3.17", "c3.18", "c3.19", "c3.20", 
                                               "c3.21", "c3.22", "c3.23", "c3.24", "c3.25", "c3.26", "c3.27", "c3.28", "c3.29", "c3.30", 
                                               "c3.31", "c3.32", "c3.33", "c3.34", "c3.35", "c3.36", "c3.37", "c3.38", "c3.39", "c3.40", 
                                               "c3.41", "c3.42", "c3.43", "c3.44", "c3.45", "c3.46", "c3.47", "c3.48", "c3.49", "c3.50", 
                                               "c3.51", "c3.52", "c3.53", "c3.54", "c3.55", "c3.56", "c3.57", "c3.58", "c3.59", "c3.60", 
                                               "c3.61", "c3.62", "c3.63", "c3.64", "c3.65", "c3.66", "c3.67", "c3.68", "c3.69", "c3.70", 
                                               "c3.71", "c3.72", "c3.73", "c3.74", "c3.75", "c3.76", "c3.77", "c3.78", "c3.79", "c3.80", 
                                               "c3.81", "c3.82", "c3.83", "c3.84", "c3.85", "c3.86", "c3.87", "c3.88", "c3.89", "c3.90", 
                                               "c3.91", "c3.92", "c3.93", "c3.94", "c3.95", "c3.96", "c3.97", "c3.98", "c3.99", "c3.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom4.final, into = c("c4.1", "c4.2", "c4.3", "c4.4", "c4.5", "c4.6", "c4.7", "c4.8", "c4.9", "c4.10", 
                                               "c4.11", "c4.12", "c4.13", "c4.14", "c4.15", "c4.16", "c4.17", "c4.18", "c4.19", "c4.20", 
                                               "c4.21", "c4.22", "c4.23", "c4.24", "c4.25", "c4.26", "c4.27", "c4.28", "c4.29", "c4.30", 
                                               "c4.31", "c4.32", "c4.33", "c4.34", "c4.35", "c4.36", "c4.37", "c4.38", "c4.39", "c4.40", 
                                               "c4.41", "c4.42", "c4.43", "c4.44", "c4.45", "c4.46", "c4.47", "c4.48", "c4.49", "c4.50", 
                                               "c4.51", "c4.52", "c4.53", "c4.54", "c4.55", "c4.56", "c4.57", "c4.58", "c4.59", "c4.60", 
                                               "c4.61", "c4.62", "c4.63", "c4.64", "c4.65", "c4.66", "c4.67", "c4.68", "c4.69", "c4.70", 
                                               "c4.71", "c4.72", "c4.73", "c4.74", "c4.75", "c4.76", "c4.77", "c4.78", "c4.79", "c4.80", 
                                               "c4.81", "c4.82", "c4.83", "c4.84", "c4.85", "c4.86", "c4.87", "c4.88", "c4.89", "c4.90", 
                                               "c4.91", "c4.92", "c4.93", "c4.94", "c4.95", "c4.96", "c4.97", "c4.98", "c4.99", "c4.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom5.final, into = c("c5.1", "c5.2", "c5.3", "c5.4", "c5.5", "c5.6", "c5.7", "c5.8", "c5.9", "c5.10", 
                                               "c5.11", "c5.12", "c5.13", "c5.14", "c5.15", "c5.16", "c5.17", "c5.18", "c5.19", "c5.20", 
                                               "c5.21", "c5.22", "c5.23", "c5.24", "c5.25", "c5.26", "c5.27", "c5.28", "c5.29", "c5.30", 
                                               "c5.31", "c5.32", "c5.33", "c5.34", "c5.35", "c5.36", "c5.37", "c5.38", "c5.39", "c5.40", 
                                               "c5.41", "c5.42", "c5.43", "c5.44", "c5.45", "c5.46", "c5.47", "c5.48", "c5.49", "c5.50", 
                                               "c5.51", "c5.52", "c5.53", "c5.54", "c5.55", "c5.56", "c5.57", "c5.58", "c5.59", "c5.60", 
                                               "c5.61", "c5.62", "c5.63", "c5.64", "c5.65", "c5.66", "c5.67", "c5.68", "c5.69", "c5.70", 
                                               "c5.71", "c5.72", "c5.73", "c5.74", "c5.75", "c5.76", "c5.77", "c5.78", "c5.79", "c5.80", 
                                               "c5.81", "c5.82", "c5.83", "c5.84", "c5.85", "c5.86", "c5.87", "c5.88", "c5.89", "c5.90", 
                                               "c5.91", "c5.92", "c5.93", "c5.94", "c5.95", "c5.96", "c5.97", "c5.98", "c5.99", "c5.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom6.final, into = c("c6.1", "c6.2", "c6.3", "c6.4", "c6.5", "c6.6", "c6.7", "c6.8", "c6.9", "c6.10", 
                                               "c6.11", "c6.12", "c6.13", "c6.14", "c6.15", "c6.16", "c6.17", "c6.18", "c6.19", "c6.20", 
                                               "c6.21", "c6.22", "c6.23", "c6.24", "c6.25", "c6.26", "c6.27", "c6.28", "c6.29", "c6.30", 
                                               "c6.31", "c6.32", "c6.33", "c6.34", "c6.35", "c6.36", "c6.37", "c6.38", "c6.39", "c6.40", 
                                               "c6.41", "c6.42", "c6.43", "c6.44", "c6.45", "c6.46", "c6.47", "c6.48", "c6.49", "c6.50", 
                                               "c6.51", "c6.52", "c6.53", "c6.54", "c6.55", "c6.56", "c6.57", "c6.58", "c6.59", "c6.60", 
                                               "c6.61", "c6.62", "c6.63", "c6.64", "c6.65", "c6.66", "c6.67", "c6.68", "c6.69", "c6.70", 
                                               "c6.71", "c6.72", "c6.73", "c6.74", "c6.75", "c6.76", "c6.77", "c6.78", "c6.79", "c6.80", 
                                               "c6.81", "c6.82", "c6.83", "c6.84", "c6.85", "c6.86", "c6.87", "c6.88", "c6.89", "c6.90", 
                                               "c6.91", "c6.92", "c6.93", "c6.94", "c6.95", "c6.96", "c6.97", "c6.98", "c6.99", "c6.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom7.final, into = c("c7.1", "c7.2", "c7.3", "c7.4", "c7.5", "c7.6", "c7.7", "c7.8", "c7.9", "c7.10", 
                                               "c7.11", "c7.12", "c7.13", "c7.14", "c7.15", "c7.16", "c7.17", "c7.18", "c7.19", "c7.20", 
                                               "c7.21", "c7.22", "c7.23", "c7.24", "c7.25", "c7.26", "c7.27", "c7.28", "c7.29", "c7.30", 
                                               "c7.31", "c7.32", "c7.33", "c7.34", "c7.35", "c7.36", "c7.37", "c7.38", "c7.39", "c7.40", 
                                               "c7.41", "c7.42", "c7.43", "c7.44", "c7.45", "c7.46", "c7.47", "c7.48", "c7.49", "c7.50", 
                                               "c7.51", "c7.52", "c7.53", "c7.54", "c7.55", "c7.56", "c7.57", "c7.58", "c7.59", "c7.60", 
                                               "c7.61", "c7.62", "c7.63", "c7.64", "c7.65", "c7.66", "c7.67", "c7.68", "c7.69", "c7.70", 
                                               "c7.71", "c7.72", "c7.73", "c7.74", "c7.75", "c7.76", "c7.77", "c7.78", "c7.79", "c7.80", 
                                               "c7.81", "c7.82", "c7.83", "c7.84", "c7.85", "c7.86", "c7.87", "c7.88", "c7.89", "c7.90", 
                                               "c7.91", "c7.92", "c7.93", "c7.94", "c7.95", "c7.96", "c7.97", "c7.98", "c7.99", "c7.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom8.final, into = c("c8.1", "c8.2", "c8.3", "c8.4", "c8.5", "c8.6", "c8.7", "c8.8", "c8.9", "c8.10", 
                                               "c8.11", "c8.12", "c8.13", "c8.14", "c8.15", "c8.16", "c8.17", "c8.18", "c8.19", "c8.20", 
                                               "c8.21", "c8.22", "c8.23", "c8.24", "c8.25", "c8.26", "c8.27", "c8.28", "c8.29", "c8.30", 
                                               "c8.31", "c8.32", "c8.33", "c8.34", "c8.35", "c8.36", "c8.37", "c8.38", "c8.39", "c8.40", 
                                               "c8.41", "c8.42", "c8.43", "c8.44", "c8.45", "c8.46", "c8.47", "c8.48", "c8.49", "c8.50", 
                                               "c8.51", "c8.52", "c8.53", "c8.54", "c8.55", "c8.56", "c8.57", "c8.58", "c8.59", "c8.60", 
                                               "c8.61", "c8.62", "c8.63", "c8.64", "c8.65", "c8.66", "c8.67", "c8.68", "c8.69", "c8.70", 
                                               "c8.71", "c8.72", "c8.73", "c8.74", "c8.75", "c8.76", "c8.77", "c8.78", "c8.79", "c8.80", 
                                               "c8.81", "c8.82", "c8.83", "c8.84", "c8.85", "c8.86", "c8.87", "c8.88", "c8.89", "c8.90", 
                                               "c8.91", "c8.92", "c8.93", "c8.94", "c8.95", "c8.96", "c8.97", "c8.98", "c8.99", "c8.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom9.final, into = c("c9.1", "c9.2", "c9.3", "c9.4", "c9.5", "c9.6", "c9.7", "c9.8", "c9.9", "c9.10", 
                                               "c9.11", "c9.12", "c9.13", "c9.14", "c9.15", "c9.16", "c9.17", "c9.18", "c9.19", "c9.20", 
                                               "c9.21", "c9.22", "c9.23", "c9.24", "c9.25", "c9.26", "c9.27", "c9.28", "c9.29", "c9.30", 
                                               "c9.31", "c9.32", "c9.33", "c9.34", "c9.35", "c9.36", "c9.37", "c9.38", "c9.39", "c9.40", 
                                               "c9.41", "c9.42", "c9.43", "c9.44", "c9.45", "c9.46", "c9.47", "c9.48", "c9.49", "c9.50", 
                                               "c9.51", "c9.52", "c9.53", "c9.54", "c9.55", "c9.56", "c9.57", "c9.58", "c9.59", "c9.60", 
                                               "c9.61", "c9.62", "c9.63", "c9.64", "c9.65", "c9.66", "c9.67", "c9.68", "c9.69", "c9.70", 
                                               "c9.71", "c9.72", "c9.73", "c9.74", "c9.75", "c9.76", "c9.77", "c9.78", "c9.79", "c9.80", 
                                               "c9.81", "c9.82", "c9.83", "c9.84", "c9.85", "c9.86", "c9.87", "c9.88", "c9.89", "c9.90", 
                                               "c9.91", "c9.92", "c9.93", "c9.94", "c9.95", "c9.96", "c9.97", "c9.98", "c9.99", "c9.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom10.final, into = c("c10.1", "c10.2", "c10.3", "c10.4", "c10.5", "c10.6", "c10.7", "c10.8", "c10.9", "c10.10", 
                                                "c10.11", "c10.12", "c10.13", "c10.14", "c10.15", "c10.16", "c10.17", "c10.18", "c10.19", "c10.20", 
                                                "c10.21", "c10.22", "c10.23", "c10.24", "c10.25", "c10.26", "c10.27", "c10.28", "c10.29", "c10.30", 
                                                "c10.31", "c10.32", "c10.33", "c10.34", "c10.35", "c10.36", "c10.37", "c10.38", "c10.39", "c10.40", 
                                                "c10.41", "c10.42", "c10.43", "c10.44", "c10.45", "c10.46", "c10.47", "c10.48", "c10.49", "c10.50", 
                                                "c10.51", "c10.52", "c10.53", "c10.54", "c10.55", "c10.56", "c10.57", "c10.58", "c10.59", "c10.60", 
                                                "c10.61", "c10.62", "c10.63", "c10.64", "c10.65", "c10.66", "c10.67", "c10.68", "c10.69", "c10.70", 
                                                "c10.71", "c10.72", "c10.73", "c10.74", "c10.75", "c10.76", "c10.77", "c10.78", "c10.79", "c10.80", 
                                                "c10.81", "c10.82", "c10.83", "c10.84", "c10.85", "c10.86", "c10.87", "c10.88", "c10.89", "c10.90", 
                                                "c10.91", "c10.92", "c10.93", "c10.94", "c10.95", "c10.96", "c10.97", "c10.98", "c10.99", "c10.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom11.final, into = c("c11.1", "c11.2", "c11.3", "c11.4", "c11.5", "c11.6", "c11.7", "c11.8", "c11.9", "c11.10", 
                                                "c11.11", "c11.12", "c11.13", "c11.14", "c11.15", "c11.16", "c11.17", "c11.18", "c11.19", "c11.20", 
                                                "c11.21", "c11.22", "c11.23", "c11.24", "c11.25", "c11.26", "c11.27", "c11.28", "c11.29", "c11.30", 
                                                "c11.31", "c11.32", "c11.33", "c11.34", "c11.35", "c11.36", "c11.37", "c11.38", "c11.39", "c11.40", 
                                                "c11.41", "c11.42", "c11.43", "c11.44", "c11.45", "c11.46", "c11.47", "c11.48", "c11.49", "c11.50", 
                                                "c11.51", "c11.52", "c11.53", "c11.54", "c11.55", "c11.56", "c11.57", "c11.58", "c11.59", "c11.60", 
                                                "c11.61", "c11.62", "c11.63", "c11.64", "c11.65", "c11.66", "c11.67", "c11.68", "c11.69", "c11.70", 
                                                "c11.71", "c11.72", "c11.73", "c11.74", "c11.75", "c11.76", "c11.77", "c11.78", "c11.79", "c11.80", 
                                                "c11.81", "c11.82", "c11.83", "c11.84", "c11.85", "c11.86", "c11.87", "c11.88", "c11.89", "c11.90", 
                                                "c11.91", "c11.92", "c11.93", "c11.94", "c11.95", "c11.96", "c11.97", "c11.98", "c11.99", "c11.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom12.final, into = c("c12.1", "c12.2", "c12.3", "c12.4", "c12.5", "c12.6", "c12.7", "c12.8", "c12.9", "c12.10", 
                                                "c12.11", "c12.12", "c12.13", "c12.14", "c12.15", "c12.16", "c12.17", "c12.18", "c12.19", "c12.20", 
                                                "c12.21", "c12.22", "c12.23", "c12.24", "c12.25", "c12.26", "c12.27", "c12.28", "c12.29", "c12.30", 
                                                "c12.31", "c12.32", "c12.33", "c12.34", "c12.35", "c12.36", "c12.37", "c12.38", "c12.39", "c12.40", 
                                                "c12.41", "c12.42", "c12.43", "c12.44", "c12.45", "c12.46", "c12.47", "c12.48", "c12.49", "c12.50", 
                                                "c12.51", "c12.52", "c12.53", "c12.54", "c12.55", "c12.56", "c12.57", "c12.58", "c12.59", "c12.60", 
                                                "c12.61", "c12.62", "c12.63", "c12.64", "c12.65", "c12.66", "c12.67", "c12.68", "c12.69", "c12.70", 
                                                "c12.71", "c12.72", "c12.73", "c12.74", "c12.75", "c12.76", "c12.77", "c12.78", "c12.79", "c12.80", 
                                                "c12.81", "c12.82", "c12.83", "c12.84", "c12.85", "c12.86", "c12.87", "c12.88", "c12.89", "c12.90", 
                                                "c12.91", "c12.92", "c12.93", "c12.94", "c12.95", "c12.96", "c12.97", "c12.98", "c12.99", "c12.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom13.final, into = c("c13.1", "c13.2", "c13.3", "c13.4", "c13.5", "c13.6", "c13.7", "c13.8", "c13.9", "c13.10", 
                                                "c13.11", "c13.12", "c13.13", "c13.14", "c13.15", "c13.16", "c13.17", "c13.18", "c13.19", "c13.20", 
                                                "c13.21", "c13.22", "c13.23", "c13.24", "c13.25", "c13.26", "c13.27", "c13.28", "c13.29", "c13.30", 
                                                "c13.31", "c13.32", "c13.33", "c13.34", "c13.35", "c13.36", "c13.37", "c13.38", "c13.39", "c13.40", 
                                                "c13.41", "c13.42", "c13.43", "c13.44", "c13.45", "c13.46", "c13.47", "c13.48", "c13.49", "c13.50", 
                                                "c13.51", "c13.52", "c13.53", "c13.54", "c13.55", "c13.56", "c13.57", "c13.58", "c13.59", "c13.60", 
                                                "c13.61", "c13.62", "c13.63", "c13.64", "c13.65", "c13.66", "c13.67", "c13.68", "c13.69", "c13.70", 
                                                "c13.71", "c13.72", "c13.73", "c13.74", "c13.75", "c13.76", "c13.77", "c13.78", "c13.79", "c13.80", 
                                                "c13.81", "c13.82", "c13.83", "c13.84", "c13.85", "c13.86", "c13.87", "c13.88", "c13.89", "c13.90", 
                                                "c13.91", "c13.92", "c13.93", "c13.94", "c13.95", "c13.96", "c13.97", "c13.98", "c13.99", "c13.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom14.final, into = c("c14.1", "c14.2", "c14.3", "c14.4", "c14.5", "c14.6", "c14.7", "c14.8", "c14.9", "c14.10", 
                                                "c14.11", "c14.12", "c14.13", "c14.14", "c14.15", "c14.16", "c14.17", "c14.18", "c14.19", "c14.20", 
                                                "c14.21", "c14.22", "c14.23", "c14.24", "c14.25", "c14.26", "c14.27", "c14.28", "c14.29", "c14.30", 
                                                "c14.31", "c14.32", "c14.33", "c14.34", "c14.35", "c14.36", "c14.37", "c14.38", "c14.39", "c14.40", 
                                                "c14.41", "c14.42", "c14.43", "c14.44", "c14.45", "c14.46", "c14.47", "c14.48", "c14.49", "c14.50", 
                                                "c14.51", "c14.52", "c14.53", "c14.54", "c14.55", "c14.56", "c14.57", "c14.58", "c14.59", "c14.60", 
                                                "c14.61", "c14.62", "c14.63", "c14.64", "c14.65", "c14.66", "c14.67", "c14.68", "c14.69", "c14.70", 
                                                "c14.71", "c14.72", "c14.73", "c14.74", "c14.75", "c14.76", "c14.77", "c14.78", "c14.79", "c14.80", 
                                                "c14.81", "c14.82", "c14.83", "c14.84", "c14.85", "c14.86", "c14.87", "c14.88", "c14.89", "c14.90", 
                                                "c14.91", "c14.92", "c14.93", "c14.94", "c14.95", "c14.96", "c14.97", "c14.98", "c14.99", "c14.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom15.final, into = c("c15.1", "c15.2", "c15.3", "c15.4", "c15.5", "c15.6", "c15.7", "c15.8", "c15.9", "c15.10", 
                                                "c15.11", "c15.12", "c15.13", "c15.14", "c15.15", "c15.16", "c15.17", "c15.18", "c15.19", "c15.20", 
                                                "c15.21", "c15.22", "c15.23", "c15.24", "c15.25", "c15.26", "c15.27", "c15.28", "c15.29", "c15.30", 
                                                "c15.31", "c15.32", "c15.33", "c15.34", "c15.35", "c15.36", "c15.37", "c15.38", "c15.39", "c15.40", 
                                                "c15.41", "c15.42", "c15.43", "c15.44", "c15.45", "c15.46", "c15.47", "c15.48", "c15.49", "c15.50", 
                                                "c15.51", "c15.52", "c15.53", "c15.54", "c15.55", "c15.56", "c15.57", "c15.58", "c15.59", "c15.60", 
                                                "c15.61", "c15.62", "c15.63", "c15.64", "c15.65", "c15.66", "c15.67", "c15.68", "c15.69", "c15.70", 
                                                "c15.71", "c15.72", "c15.73", "c15.74", "c15.75", "c15.76", "c15.77", "c15.78", "c15.79", "c15.80", 
                                                "c15.81", "c15.82", "c15.83", "c15.84", "c15.85", "c15.86", "c15.87", "c15.88", "c15.89", "c15.90", 
                                                "c15.91", "c15.92", "c15.93", "c15.94", "c15.95", "c15.96", "c15.97", "c15.98", "c15.99", "c15.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom16.final, into = c("c16.1", "c16.2", "c16.3", "c16.4", "c16.5", "c16.6", "c16.7", "c16.8", "c16.9", "c16.10", 
                                                "c16.11", "c16.12", "c16.13", "c16.14", "c16.15", "c16.16", "c16.17", "c16.18", "c16.19", "c16.20", 
                                                "c16.21", "c16.22", "c16.23", "c16.24", "c16.25", "c16.26", "c16.27", "c16.28", "c16.29", "c16.30", 
                                                "c16.31", "c16.32", "c16.33", "c16.34", "c16.35", "c16.36", "c16.37", "c16.38", "c16.39", "c16.40", 
                                                "c16.41", "c16.42", "c16.43", "c16.44", "c16.45", "c16.46", "c16.47", "c16.48", "c16.49", "c16.50", 
                                                "c16.51", "c16.52", "c16.53", "c16.54", "c16.55", "c16.56", "c16.57", "c16.58", "c16.59", "c16.60", 
                                                "c16.61", "c16.62", "c16.63", "c16.64", "c16.65", "c16.66", "c16.67", "c16.68", "c16.69", "c16.70", 
                                                "c16.71", "c16.72", "c16.73", "c16.74", "c16.75", "c16.76", "c16.77", "c16.78", "c16.79", "c16.80", 
                                                "c16.81", "c16.82", "c16.83", "c16.84", "c16.85", "c16.86", "c16.87", "c16.88", "c16.89", "c16.90", 
                                                "c16.91", "c16.92", "c16.93", "c16.94", "c16.95", "c16.96", "c16.97", "c16.98", "c16.99", "c16.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom17.final, into = c("c17.1", "c17.2", "c17.3", "c17.4", "c17.5", "c17.6", "c17.7", "c17.8", "c17.9", "c17.10", 
                                                "c17.11", "c17.12", "c17.13", "c17.14", "c17.15", "c17.16", "c17.17", "c17.18", "c17.19", "c17.20", 
                                                "c17.21", "c17.22", "c17.23", "c17.24", "c17.25", "c17.26", "c17.27", "c17.28", "c17.29", "c17.30", 
                                                "c17.31", "c17.32", "c17.33", "c17.34", "c17.35", "c17.36", "c17.37", "c17.38", "c17.39", "c17.40", 
                                                "c17.41", "c17.42", "c17.43", "c17.44", "c17.45", "c17.46", "c17.47", "c17.48", "c17.49", "c17.50", 
                                                "c17.51", "c17.52", "c17.53", "c17.54", "c17.55", "c17.56", "c17.57", "c17.58", "c17.59", "c17.60", 
                                                "c17.61", "c17.62", "c17.63", "c17.64", "c17.65", "c17.66", "c17.67", "c17.68", "c17.69", "c17.70", 
                                                "c17.71", "c17.72", "c17.73", "c17.74", "c17.75", "c17.76", "c17.77", "c17.78", "c17.79", "c17.80", 
                                                "c17.81", "c17.82", "c17.83", "c17.84", "c17.85", "c17.86", "c17.87", "c17.88", "c17.89", "c17.90", 
                                                "c17.91", "c17.92", "c17.93", "c17.94", "c17.95", "c17.96", "c17.97", "c17.98", "c17.99", "c17.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom18.final, into = c("c18.1", "c18.2", "c18.3", "c18.4", "c18.5", "c18.6", "c18.7", "c18.8", "c18.9", "c18.10", 
                                                "c18.11", "c18.12", "c18.13", "c18.14", "c18.15", "c18.16", "c18.17", "c18.18", "c18.19", "c18.20", 
                                                "c18.21", "c18.22", "c18.23", "c18.24", "c18.25", "c18.26", "c18.27", "c18.28", "c18.29", "c18.30", 
                                                "c18.31", "c18.32", "c18.33", "c18.34", "c18.35", "c18.36", "c18.37", "c18.38", "c18.39", "c18.40", 
                                                "c18.41", "c18.42", "c18.43", "c18.44", "c18.45", "c18.46", "c18.47", "c18.48", "c18.49", "c18.50", 
                                                "c18.51", "c18.52", "c18.53", "c18.54", "c18.55", "c18.56", "c18.57", "c18.58", "c18.59", "c18.60", 
                                                "c18.61", "c18.62", "c18.63", "c18.64", "c18.65", "c18.66", "c18.67", "c18.68", "c18.69", "c18.70", 
                                                "c18.71", "c18.72", "c18.73", "c18.74", "c18.75", "c18.76", "c18.77", "c18.78", "c18.79", "c18.80", 
                                                "c18.81", "c18.82", "c18.83", "c18.84", "c18.85", "c18.86", "c18.87", "c18.88", "c18.89", "c18.90", 
                                                "c18.91", "c18.92", "c18.93", "c18.94", "c18.95", "c18.96", "c18.97", "c18.98", "c18.99", "c18.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom19.final, into = c("c19.1", "c19.2", "c19.3", "c19.4", "c19.5", "c19.6", "c19.7", "c19.8", "c19.9", "c19.10", 
                                                "c19.11", "c19.12", "c19.13", "c19.14", "c19.15", "c19.16", "c19.17", "c19.18", "c19.19", "c19.20", 
                                                "c19.21", "c19.22", "c19.23", "c19.24", "c19.25", "c19.26", "c19.27", "c19.28", "c19.29", "c19.30", 
                                                "c19.31", "c19.32", "c19.33", "c19.34", "c19.35", "c19.36", "c19.37", "c19.38", "c19.39", "c19.40", 
                                                "c19.41", "c19.42", "c19.43", "c19.44", "c19.45", "c19.46", "c19.47", "c19.48", "c19.49", "c19.50", 
                                                "c19.51", "c19.52", "c19.53", "c19.54", "c19.55", "c19.56", "c19.57", "c19.58", "c19.59", "c19.60", 
                                                "c19.61", "c19.62", "c19.63", "c19.64", "c19.65", "c19.66", "c19.67", "c19.68", "c19.69", "c19.70", 
                                                "c19.71", "c19.72", "c19.73", "c19.74", "c19.75", "c19.76", "c19.77", "c19.78", "c19.79", "c19.80", 
                                                "c19.81", "c19.82", "c19.83", "c19.84", "c19.85", "c19.86", "c19.87", "c19.88", "c19.89", "c19.90", 
                                                "c19.91", "c19.92", "c19.93", "c19.94", "c19.95", "c19.96", "c19.97", "c19.98", "c19.99", "c19.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom20.final, into = c("c20.1", "c20.2", "c20.3", "c20.4", "c20.5", "c20.6", "c20.7", "c20.8", "c20.9", "c20.10", 
                                                "c20.11", "c20.12", "c20.13", "c20.14", "c20.15", "c20.16", "c20.17", "c20.18", "c20.19", "c20.20", 
                                                "c20.21", "c20.22", "c20.23", "c20.24", "c20.25", "c20.26", "c20.27", "c20.28", "c20.29", "c20.30", 
                                                "c20.31", "c20.32", "c20.33", "c20.34", "c20.35", "c20.36", "c20.37", "c20.38", "c20.39", "c20.40", 
                                                "c20.41", "c20.42", "c20.43", "c20.44", "c20.45", "c20.46", "c20.47", "c20.48", "c20.49", "c20.50", 
                                                "c20.51", "c20.52", "c20.53", "c20.54", "c20.55", "c20.56", "c20.57", "c20.58", "c20.59", "c20.60", 
                                                "c20.61", "c20.62", "c20.63", "c20.64", "c20.65", "c20.66", "c20.67", "c20.68", "c20.69", "c20.70", 
                                                "c20.71", "c20.72", "c20.73", "c20.74", "c20.75", "c20.76", "c20.77", "c20.78", "c20.79", "c20.80", 
                                                "c20.81", "c20.82", "c20.83", "c20.84", "c20.85", "c20.86", "c20.87", "c20.88", "c20.89", "c20.90", 
                                                "c20.91", "c20.92", "c20.93", "c20.94", "c20.95", "c20.96", "c20.97", "c20.98", "c20.99", "c20.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom21.final, into = c("c21.1", "c21.2", "c21.3", "c21.4", "c21.5", "c21.6", "c21.7", "c21.8", "c21.9", "c21.10", 
                                                "c21.11", "c21.12", "c21.13", "c21.14", "c21.15", "c21.16", "c21.17", "c21.18", "c21.19", "c21.20", 
                                                "c21.21", "c21.22", "c21.23", "c21.24", "c21.25", "c21.26", "c21.27", "c21.28", "c21.29", "c21.30", 
                                                "c21.31", "c21.32", "c21.33", "c21.34", "c21.35", "c21.36", "c21.37", "c21.38", "c21.39", "c21.40", 
                                                "c21.41", "c21.42", "c21.43", "c21.44", "c21.45", "c21.46", "c21.47", "c21.48", "c21.49", "c21.50", 
                                                "c21.51", "c21.52", "c21.53", "c21.54", "c21.55", "c21.56", "c21.57", "c21.58", "c21.59", "c21.60", 
                                                "c21.61", "c21.62", "c21.63", "c21.64", "c21.65", "c21.66", "c21.67", "c21.68", "c21.69", "c21.70", 
                                                "c21.71", "c21.72", "c21.73", "c21.74", "c21.75", "c21.76", "c21.77", "c21.78", "c21.79", "c21.80", 
                                                "c21.81", "c21.82", "c21.83", "c21.84", "c21.85", "c21.86", "c21.87", "c21.88", "c21.89", "c21.90", 
                                                "c21.91", "c21.92", "c21.93", "c21.94", "c21.95", "c21.96", "c21.97", "c21.98", "c21.99", "c21.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, Chrom22.final, into = c("c22.1", "c22.2", "c22.3", "c22.4", "c22.5", "c22.6", "c22.7", "c22.8", "c22.9", "c22.10", 
                                                "c22.11", "c22.12", "c22.13", "c22.14", "c22.15", "c22.16", "c22.17", "c22.18", "c22.19", "c22.20", 
                                                "c22.21", "c22.22", "c22.23", "c22.24", "c22.25", "c22.26", "c22.27", "c22.28", "c22.29", "c22.30", 
                                                "c22.31", "c22.32", "c22.33", "c22.34", "c22.35", "c22.36", "c22.37", "c22.38", "c22.39", "c22.40", 
                                                "c22.41", "c22.42", "c22.43", "c22.44", "c22.45", "c22.46", "c22.47", "c22.48", "c22.49", "c22.50", 
                                                "c22.51", "c22.52", "c22.53", "c22.54", "c22.55", "c22.56", "c22.57", "c22.58", "c22.59", "c22.60", 
                                                "c22.61", "c22.62", "c22.63", "c22.64", "c22.65", "c22.66", "c22.67", "c22.68", "c22.69", "c22.70", 
                                                "c22.71", "c22.72", "c22.73", "c22.74", "c22.75", "c22.76", "c22.77", "c22.78", "c22.79", "c22.80", 
                                                "c22.81", "c22.82", "c22.83", "c22.84", "c22.85", "c22.86", "c22.87", "c22.88", "c22.89", "c22.90", 
                                                "c22.91", "c22.92", "c22.93", "c22.94", "c22.95", "c22.96", "c22.97", "c22.98", "c22.99", "c22.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf<- separate(newdf, ChromX.final, into = c("cx.1", "cx.2", "cx.3", "cx.4", "cx.5", "cx.6", "cx.7", "cx.8", "cx.9", "cx.10", 
                                               "cx.11", "cx.12", "cx.13", "cx.14", "cx.15", "cx.16", "cx.17", "cx.18", "cx.19", "cx.20", 
                                               "cx.21", "cx.22", "cx.23", "cx.24", "cx.25", "cx.26", "cx.27", "cx.28", "cx.29", "cx.30", 
                                               "cx.31", "cx.32", "cx.33", "cx.34", "cx.35", "cx.36", "cx.37", "cx.38", "cx.39", "cx.40", 
                                               "cx.41", "cx.42", "cx.43", "cx.44", "cx.45", "cx.46", "cx.47", "cx.48", "cx.49", "cx.50", 
                                               "cx.51", "cx.52", "cx.53", "cx.54", "cx.55", "cx.56", "cx.57", "cx.58", "cx.59", "cx.60", 
                                               "cx.61", "cx.62", "cx.63", "cx.64", "cx.65", "cx.66", "cx.67", "cx.68", "cx.69", "cx.70", 
                                               "cx.71", "cx.72", "cx.73", "cx.74", "cx.75", "cx.76", "cx.77", "cx.78", "cx.79", "cx.80", 
                                               "cx.81", "cx.82", "cx.83", "cx.84", "cx.85", "cx.86", "cx.87", "cx.88", "cx.89", "cx.90", 
                                               "cx.91", "cx.92", "cx.93", "cx.94", "cx.95", "cx.96", "cx.97", "cx.98", "cx.99", "cx.100"), 
                 extra = "merge", fill = "warn", convert = TRUE, remove = TRUE, "[^[:alnum:]]+")

newdf$SAC <- NULL
newdf$show.resources. <- NULL
newdf$initial.number <- NULL
newdf$end.population <- NULL
newdf$outputcount <- NULL
newdf <- arrange(newdf, X.run.number.)

testdf <- melt(newdf, id.vars = c("X.run.number.", "end.ticks",  "initial.CIN", "CIN.rate", "initial.ploidy", "selective.pressure", "X.step.", "count.tumorcells", "count.turtles.with..karyotype...23....initial.ploidy.", "MKV", "periodicity")) #ADD VARIABLES

separatedtest <- separate(testdf, "variable", c("chromosome","cell.id"), sep = "\\.")

recast <- dcast(separatedtest, X.run.number. + initial.CIN + end.ticks + CIN.rate + cell.id + X.step. + initial.ploidy + selective.pressure + count.tumorcells + count.turtles.with..karyotype...23....initial.ploidy.  + MKV + periodicity ~ chromosome, value.var = "value")

EuclideanMeasurement <- function(x) {
  mean(dist(as.matrix(subset(recast,X.run.number. == x)[13:35])))
}

run <- c(1:length(unique(recast$X.run.number.)))
test <- as.data.frame(run)
test$euc <- apply(test, 1, EuclideanMeasurement)
euc <- rep(test$euc, nrow(recast)/length(unique(recast$X.run.number.)))
testdf <- cbind(recast, euc)
testdf1 <- distinct(testdf[,c(1,4,8,11,12,36)])
testdf1$clusters <- clusters
testdf1 <- arrange(testdf1, CIN.rate, periodicity, selective.pressure)
testdf1$rep <- rep(seq(1:5), 264)
testdf1sb <- subset(testdf1, selective.pressure != 0)
testdf1sb$CIN.rate <- round(testdf1sb$CIN.rate, 4)

library(ggplot2)
library(ggpubr)

plot <- ggplot(testdf1sb, aes(x=log10(selective.pressure), y = euc, fill = as.factor(selective.pressure))) + 
  geom_line(group = testdf1sb$rep, lty = 3) +
  geom_point(size = 3, shape = 21) + 
  facet_grid(periodicity ~ CIN.rate) + 
  theme_bw() + 
  theme(axis.text = element_text(angle = 90, color = "black")) +
  theme(strip.text.x = element_text(color="black",
                                  face="bold"),
      strip.text.y = element_text(color="black",
                                  face="bold")) + 
  theme(legend.title = element_text(face = "bold"), legend.position = "none") + 
  guides(fill=guide_legend(title="log10(Selection)")) + 
  xlab("log10(Selection)") + 
  ylab("Mean Euclidean Distance")

library(dendextend)
library(circlize)
library(colorspace)
library(vegan)
library(reshape2)
###Enter run number 
clusters <- c()
for (nx in distinct(testdf[,c(1,4,8,11,12,36)])[complete.cases(distinct(testdf[,c(1,4,8,11,12,36)])), ]$X.run.number.) {
  print(nx)
###Cluster
testset <- subset(recast[complete.cases(recast), ],X.run.number. == nx)[13:35]
hc <- hclust(dist(as.matrix(testset)), method = "complete")

###Optimal clustering
df <- melt(as.matrix(dist(as.matrix(testset)), varnames = c("row", "col")))
  if (any(is.na(scale(df)[,3])) == TRUE){
    clusters[nx] <- NA
    next
  }
fit <- cascadeKM(scale(df, center = TRUE,  scale = TRUE), 1, 10, iter = 10)
#dev.off()
#plot(fit, sortg = TRUE, grpmts.plot = TRUE)
calinskiclusters <- as.numeric(which.max(fit$results[2,]))
clusters[nx] <- calinski.best

#Calculate mean euclidean distance within cluster
testset$ClusterID <- cutree(hc, calinskiclusters)
clustermeanvar <- c()
for (i in seq(calinski.best)) {
  clustermeanvar[i] <- mean(dist(as.matrix(subset(testset, ClusterID == i)[1:23])))
  intraclustermeaneuc <- mean(clustermeanvar, na.rm = TRUE)
}

#Calculate mean euclidean distance between clusters

#Calculate some ratio between number of clusters, distance within and distance between


}

###Dendextend
dend <- as.dendrogram(hc)
num_clusters <- calinskiclusters
dend <- dend %>% 
  color_branches(k=num_clusters, col=rainbow_hcl) %>%
  set("branches_lwd", 4) %>%
  set("labels_cex", 0.8) %>%
  set("labels", c(1:100))

par(mar = rep(0, 4))
circlize_dendrogram(dend, dend_track_height = 0.8)

#Heatmap
dev.off()
heatmap <- heatmap.2(as.matrix(subset(recast,X.run.number. == nx)[13:35]),   # Tidy, normalised data
                     Rowv=TRUE,
                     Colv=FALSE,
                     density.info="histogram",
                     dendrogram = "row",
                     trace="none")               # Turn of trace lines from heat map


###Comparitive cluster number analysis

testdf1sb$clusters <- clusters[!is.na(clusters)]
testdf1sb$clusters <- clusters[!is.na(testdf1sb)]

plot <- ggplot(testdf1sb, aes(x=log10(selective.pressure), y = clusters, fill = as.factor(selective.pressure))) + 
  geom_line(group = testdf1sb$rep, lty = 3) +
  geom_point(size = 3, shape = 21) + 
  facet_grid(periodicity ~ CIN.rate) + 
  theme_bw() + 
  theme(axis.text = element_text(angle = 90, color = "black")) +
  theme(strip.text.x = element_text(color="black",
                                    face="bold"),
        strip.text.y = element_text(color="black",
                                    face="bold")) + 
  theme(legend.title = element_text(face = "bold"), legend.position = "none") + 
  guides(fill=guide_legend(title="log10(Selection)")) + 
  xlab("log10(Selection)") + 
  ylab("Clusters")
